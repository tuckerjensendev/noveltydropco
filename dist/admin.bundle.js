/*! For license information please see admin.bundle.js.LICENSE.txt */
(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){"use strict";t=function(){return o};var n,o={},r=Object.prototype,c=r.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},l="function"==typeof Symbol?Symbol:{},i=l.iterator||"@@iterator",s=l.asyncIterator||"@@asyncIterator",d=l.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(n){u=function(e,t,n){return e[t]=n}}function f(e,t,n,o){var r=t&&t.prototype instanceof m?t:m,c=Object.create(r.prototype),l=new T(o||[]);return a(c,"_invoke",{value:U(e,n,l)}),c}function g(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}o.wrap=f;var v="suspendedStart",p="suspendedYield",h="executing",y="completed",b={};function m(){}function k(){}function E(){}var B={};u(B,i,(function(){return this}));var w=Object.getPrototypeOf,D=w&&w(w(O([])));D&&D!==r&&c.call(D,i)&&(B=D);var x=E.prototype=m.prototype=Object.create(B);function L(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function G(t,n){function o(r,a,l,i){var s=g(t[r],t,a);if("throw"!==s.type){var d=s.arg,u=d.value;return u&&"object"==e(u)&&c.call(u,"__await")?n.resolve(u.__await).then((function(e){o("next",e,l,i)}),(function(e){o("throw",e,l,i)})):n.resolve(u).then((function(e){d.value=e,l(d)}),(function(e){return o("throw",e,l,i)}))}i(s.arg)}var r;a(this,"_invoke",{value:function(e,t){function c(){return new n((function(n,r){o(e,t,n,r)}))}return r=r?r.then(c,c):c()}})}function U(e,t,o){var r=v;return function(c,a){if(r===h)throw Error("Generator is already running");if(r===y){if("throw"===c)throw a;return{value:n,done:!0}}for(o.method=c,o.arg=a;;){var l=o.delegate;if(l){var i=S(l,o);if(i){if(i===b)continue;return i}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(r===v)throw r=y,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);r=h;var s=g(e,t,o);if("normal"===s.type){if(r=o.done?y:p,s.arg===b)continue;return{value:s.arg,done:o.done}}"throw"===s.type&&(r=y,o.method="throw",o.arg=s.arg)}}}function S(e,t){var o=t.method,r=e.iterator[o];if(r===n)return t.delegate=null,"throw"===o&&e.iterator.return&&(t.method="return",t.arg=n,S(e,t),"throw"===t.method)||"return"!==o&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+o+"' method")),b;var c=g(r,e.iterator,t.arg);if("throw"===c.type)return t.method="throw",t.arg=c.arg,t.delegate=null,b;var a=c.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,b):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,b)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function O(t){if(t||""===t){var o=t[i];if(o)return o.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,a=function e(){for(;++r<t.length;)if(c.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=n,e.done=!0,e};return a.next=a}}throw new TypeError(e(t)+" is not iterable")}return k.prototype=E,a(x,"constructor",{value:E,configurable:!0}),a(E,"constructor",{value:k,configurable:!0}),k.displayName=u(E,d,"GeneratorFunction"),o.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===k||"GeneratorFunction"===(t.displayName||t.name))},o.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,E):(e.__proto__=E,u(e,d,"GeneratorFunction")),e.prototype=Object.create(x),e},o.awrap=function(e){return{__await:e}},L(G.prototype),u(G.prototype,s,(function(){return this})),o.AsyncIterator=G,o.async=function(e,t,n,r,c){void 0===c&&(c=Promise);var a=new G(f(e,t,n,r),c);return o.isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},L(x),u(x,d,"Generator"),u(x,i,(function(){return this})),u(x,"toString",(function(){return"[object Generator]"})),o.keys=function(e){var t=Object(e),n=[];for(var o in t)n.push(o);return n.reverse(),function e(){for(;n.length;){var o=n.pop();if(o in t)return e.value=o,e.done=!1,e}return e.done=!0,e}},o.values=O,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(A),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function o(o,r){return l.type="throw",l.arg=e,t.next=o,r&&(t.method="next",t.arg=n),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],l=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var i=c.call(a,"catchLoc"),s=c.call(a,"finallyLoc");if(i&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(i){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&c.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=e,a.arg=t,r?(this.method="next",this.next=r.finallyLoc,b):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var o=n.completion;if("throw"===o.type){var r=o.arg;A(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(e,t,o){return this.delegate={iterator:O(e),resultName:t,nextLoc:o},"next"===this.method&&(this.arg=n),b}},o}function n(e,t,n,o,r,c,a){try{var l=e[c](a),i=l.value}catch(e){return void n(e)}l.done?t(i):Promise.resolve(i).then(o,r)}function o(e){return function(){var t=this,o=arguments;return new Promise((function(r,c){var a=e.apply(t,o);function l(e){n(a,r,c,l,i,"next",e)}function i(e){n(a,r,c,l,i,"throw",e)}l(void 0)}))}}function r(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,c(o.key),o)}}function c(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}document.addEventListener("DOMContentLoaded",(function(){console.log("[DEBUG] contentWorkshop.js loaded and DOMContentLoaded triggered.");var e=document.getElementById("contentPreview"),n=document.getElementById("blockTypeControl"),c=document.getElementById("addBlockButton"),a=document.getElementById("saveDraftButton"),l=document.getElementById("pushLiveButton"),i=document.getElementById("undoButton"),s=document.getElementById("redoButton"),d=document.getElementById("clearContentButton"),u=document.getElementById("deleteModeButton"),f=document.getElementById("viewToggleButton"),g=document.getElementById("copyLiveButton"),v=document.getElementById("sharedToolbar"),p=document.querySelector(".toolbar-row.second-row"),h=document.querySelector(".main-content"),y="/images/svg/lock-locked.svg",b="/images/svg/lock-unlocked.svg",m=document.getElementById("customBlockTypeDropdown"),k=document.querySelector(".dropdown-menu");if(n&&c&&a&&l&&i&&s&&d&&u&&f&&g&&v&&h){var E;console.log("[DEBUG] All critical DOM elements are present.");var B,w=[],D=[],x=[],L=[],G=[],U=!1,S="draft",I=e,A=!1,T=!1,O=!1,C=!1,N=null,P=!1,j=!1,M=!1,q=!1,R=null,F=new(function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.queue=[],this.locked=!1},(t=[{key:"lock",value:function(){var e=this;return new Promise((function(t){e.locked?(console.log("[DEBUG] Mutex is currently locked. Adding to queue."),e.queue.push(t)):(e.locked=!0,console.log("[DEBUG] Mutex is now locked."),t())}))}},{key:"unlock",value:function(){if(this.locked)if(this.queue.length>0){var e=this.queue.shift();console.log("[DEBUG] Passing lock to the next requester in the queue."),e()}else this.locked=!1,console.log("[DEBUG] Mutex is now unlocked.");else console.warn("[DEBUG] Attempted to unlock a mutex that is not locked.")}}])&&r(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}());window.sharedMutex=F,e?(console.log("[DEBUG] 'contentPreview' found. Initializing in 'draft' mode."),S="draft",I=e):(console.log("[DEBUG] No 'contentPreview' found. Displaying 'NO DRAFT SAVED'."),ne(),I=null);var _=0,H=function(){var t=(null==p?void 0:p.offsetHeight)||0,n=20+.015*window.innerHeight;e.style.setProperty("--secondary-toolbar-height","".concat(t,"px")),e.style.setProperty("--dynamic-bottom-padding","".concat(n,"px"));var o=t-_;o>0?(e.scrollTop+=o,console.log("[DEBUG] Scrolled down by ".concat(o,"px to adjust for toolbar expansion."))):o<0&&(e.scrollTop+=o,console.log("[DEBUG] Scrolled up by ".concat(-o,"px to adjust for toolbar collapse."))),_=t,console.log("[DEBUG] Toolbar Height: ".concat(t,"px | Bottom Padding: ").concat(n,"px"))};H(),new MutationObserver((function(){console.log("[DEBUG] Toolbar mutation observed. Updating padding."),H()})).observe(p,{attributes:!0,childList:!0,subtree:!1}),window.addEventListener("resize",H),h.addEventListener("scroll",(function(){h.scrollTop>0?(v.style.zIndex="10",v.classList.add("scrolled")):(v.style.zIndex="",v.classList.remove("scrolled"))})),v&&p?(p.style.display="none",B?console.warn("[DEBUG] Toolbar tab already exists. Skipping creation."):((B=document.createElement("div")).id="toolbarTab",B.className="toolbar-tab",B.innerHTML="<span>&#x25B2;</span>",B.enabled="draft"===S,B.enabled||B.classList.add("no-hover"),v.appendChild(B),B.addEventListener("click",(function(){if(B.enabled){var e="none"!==p.style.display;p.style.display=e?"none":"flex",B.innerHTML=e?"<span>&#x25B2;</span>":"<span>&#x25BC;</span>",B.classList.toggle("expanded",!e)}else console.log("[DEBUG] Toolbar tab click ignored because it is disabled.")})))):console.error("[DEBUG] Toolbar or second toolbar row is missing."),f.textContent="draft"===S?"View Live":"View Draft",i.disabled=!0,s.disabled=!0,a.disabled=!0,l.disabled=!0,d.disabled=0===w.length||O||"live"===S||null!==R;var V=function(){i.disabled=U?0===L.length:D.length<=1,s.disabled=U?0===G.length:0===x.length,console.log("[DEBUG] Undo button is now ".concat(i.disabled?"disabled":"enabled",".")),console.log("[DEBUG] Redo button is now ".concat(s.disabled?"disabled":"enabled","."))},z=function(){a.disabled=!A||O||"live"===S,l.disabled=A||O||C||"live"===S||null!==R,g.disabled=null!==R||"draft"!==S,f.disabled=null!==R||O,n.disabled=null!==R||O||"live"===S,c.disabled=null!==R||U||O||"live"===S,u.disabled=null!==R||O||"draft"!==S,m&&(m.disabled=null!==R||O||"live"===S),d.disabled=0===w.length||O||"live"===S||null!==R,V(),console.log("[DEBUG] Button states updated:\n            Save Draft: ".concat(a.disabled?"disabled":"enabled",",\n            Push Live: ").concat(l.disabled?"disabled":"enabled",",\n            Copy Live: ").concat(g.disabled?"disabled":"enabled",",\n            Clear Content: ").concat(d.disabled?"disabled":"enabled","."))},J=function(e){var t=e.querySelector(".lock-overlay"),n=e.querySelector(".block-content");if(t){var o="true"===t.dataset.locked;o?(t.dataset.locked="false",e.setAttribute("data-unlocked","true"),t.innerHTML='<img src="'.concat(b,'" alt="Unlocked" class="lock-icon" />'),n.contentEditable="true",e.classList.remove("default-border"),e.classList.add("unlocked-border"),R=e,console.log("[DEBUG] Block unlocked."),E&&(E.destroy(),E=null,console.log("[DEBUG] Sortable.js instance destroyed due to unlocked block.")),p&&(p.style.display="flex",B&&(B.innerHTML="<span>&#x25BC;</span>",B.classList.add("expanded")),console.log("[DEBUG] Secondary toolbar opened due to block unlocking."))):(t.dataset.locked="true",e.removeAttribute("data-unlocked"),t.innerHTML='<img src="'.concat(y,'" alt="Locked" class="lock-icon" />'),n.contentEditable="false",e.classList.contains("grid-overlay-active")&&(e.classList.remove("grid-overlay-active"),gridOverlayActive=!1,console.log("[DEBUG] Grid overlay removed due to block being locked.")),R===e&&(R=null,console.log("[DEBUG] Locked previously unlocked block. Reset currentlyUnlockedBlock.")),e.classList.remove("unlocked-border"),e.classList.add("default-border"),console.log("[DEBUG] Block locked."),R||U||"draft"!==S||(W(),console.log("[DEBUG] Sortable.js re-initialized after locking block.")));var r=new CustomEvent("blockLockChanged",{detail:{blockId:e.dataset.blockId||null,isLocked:!o}});window.dispatchEvent(r),z()}else console.error("[DEBUG] Lock overlay element not found.")},Y=function(e){if(R&&R!==e){console.log("[DEBUG] Another block is already unlocked."),alert("Please lock the currently unlocked block before unlocking another.");var t=I.getBoundingClientRect(),n=R.getBoundingClientRect().top-t.top+I.scrollTop;return I.scrollTo({top:n-10,behavior:"smooth"}),!1}return!0},W=function(){if(console.log("[DEBUG] Initializing Sortable.js..."),E&&(E.destroy(),E=null,console.log("[DEBUG] Previous Sortable.js instance destroyed.")),"live"===S||U||null!==R)console.log("[DEBUG] View mode is 'live', delete mode is active, sort is locked, or a block is unlocked; skipping Sortable.js initialization.");else{var e;Array.from(I.children).forEach((function(e){e.style.gridArea=""})),I.style.overflowY="auto",I.style.overflowX="hidden",document.body.style.overflow="hidden";var t=190,n=!1,o=0,r=function(r){I.getBoundingClientRect(),o=r,n||(n=!0,e=setInterval((function(){var e=I.getBoundingClientRect();if(o<e.top+t){var n=Math.max(1,(e.top+t-o)/t);I.scrollTop-=10*n,console.log("[DEBUG] Scrolling gridContainer up. Speed: ".concat(10*n))}else if(o>e.bottom-190){var r=Math.max(1,(o-(e.bottom-190))/t);I.scrollTop+=10*r,console.log("[DEBUG] Scrolling gridContainer down. Speed: ".concat(10*r))}else c()}),16))},c=function(){clearInterval(e),n=!1,console.log("[DEBUG] Scrolling stopped.")};E=Sortable.create(I,{animation:150,handle:".grid-item",scroll:!1,ghostClass:"ghost",onStart:function(e){document.body.style.overflow="hidden",console.log("[DEBUG] Body scrolling disabled."),console.log("[DEBUG] Dragging started."),e.item.classList.add("active-dragged"),r(e.originalEvent.clientY)},onMove:function(e){var t=e.originalEvent.clientY;o=t,r(t)},onEnd:function(e){document.body.style.overflow="",console.log("[DEBUG] Body scrolling enabled."),c(),console.log("[DEBUG] Drag event ended."),console.log("[DEBUG] Old Index: ".concat(e.oldIndex,", New Index: ").concat(e.newIndex)),e.item.classList.remove("active-dragged"),e.oldIndex!==e.newIndex?(Q(),K(),A=!0,C=!1,z(),console.log("[DEBUG] Block order changed and layout updated.")):console.log("[DEBUG] Block order unchanged.")}}),console.log("[DEBUG] Sortable.js initialized successfully.")}},X=function(e){if(U){var t=e.target.closest(".grid-item");if(t){console.log("[DEBUG] Block clicked for deletion: ".concat(t.dataset.blockId)),R===t&&(R=null,console.log("[DEBUG] Deleted block was unlocked. Resetting currentlyUnlockedBlock."));var n=Array.from(I.children).filter((function(e){return!e.classList.contains("no-saved-draft")})).indexOf(t);L.push({blockElement:t.cloneNode(!0),index:n}),G=[],V(),t.remove(),Q(),T=!0}}},K=function(){"draft"===S&&(console.log("[DEBUG] Saving current layout state to history..."),D.push(JSON.parse(JSON.stringify(w))),x=[],console.log("[DEBUG] Layout history updated. Current history length:",D.length),V())},Q=function(){if("draft"===S){console.log("[DEBUG] Updating local layout from DOM...");var e=Array.from(I.querySelectorAll(".grid-item")).filter((function(e){return!e.classList.contains("no-saved-draft")}));w=e.map((function(e,t){var n,o,r,c,a=window.getComputedStyle(e),l=parseInt((null===(n=a.getPropertyValue("grid-row").split("span")[1])||void 0===n?void 0:n.trim())||1),i=parseInt((null===(o=a.getPropertyValue("grid-column").split("span")[1])||void 0===o?void 0:o.trim())||1);return{block_id:e.dataset.blockId||null,type:e.classList[1],content:(null===(r=e.querySelector(".block-content"))||void 0===r?void 0:r.innerHTML)||"",row:t+1,col:1,width:i,height:l,style:e.style.cssText||null,page_id:null===(c=document.querySelector(".side-panel .active"))||void 0===c?void 0:c.dataset.page,locked:"false"!==e.querySelector(".lock-overlay").dataset.locked}})),console.log("[DEBUG] Updated local layout:",JSON.stringify(w,null,2))}},Z=function(){if("draft"===S){if(U&&L.length>0){var e=L.pop();console.log("[DEBUG] Undoing last deletion."),G.push(e);var t=e.blockElement.cloneNode(!0);t.classList.add("default-border"),e.index>=I.children.length?(I.appendChild(t),console.log("[DEBUG] Inserted block at the end (index ".concat(e.index,")."))):(I.insertBefore(t,I.children[e.index]),console.log("[DEBUG] Inserted block at index ".concat(e.index,"."))),t.querySelector(".lock-overlay").addEventListener("click",(function(e){e.stopPropagation(),Y(t)&&J(t)})),Q(),W()}else if(!U&&D.length>1){x.push(D.pop());var n=D[D.length-1];w=n,console.log("[DEBUG] Undoing layout change. Reverting to previous state:",JSON.stringify(n,null,2)),re(n),A=!0,C=!1,z()}else console.log("[DEBUG] No more undo steps available.");V()}},$=function(){if("draft"===S){if(U&&G.length>0){var e=G.pop();console.log("[DEBUG] Redoing last deletion."),L.push(e);var t=I.children[e.index];t?(t.remove(),console.log("[DEBUG] Removed block from index ".concat(e.index,"."))):console.log("[DEBUG] No block found at index ".concat(e.index," to remove.")),Q(),W()}else if(!U&&x.length>0){var n=x.pop();D.push(n),w=n,console.log("[DEBUG] Redoing layout change. Moving to next state:",JSON.stringify(n,null,2)),re(n),A=!0,C=!1,z()}else console.log("[DEBUG] No more redo steps available.");V()}},ee=function(){var e=o(t().mark((function e(n){var o,r,c,a,l,i;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("draft"===S){e.next=2;break}return e.abrupt("return");case 2:if(!O){e.next=5;break}return console.log("[DEBUG] Save operation already in progress. Aborting new save request."),e.abrupt("return");case 5:if(O=!0,z(),r=null===(o=document.querySelector(".side-panel .active"))||void 0===o?void 0:o.dataset.page){e.next=13;break}return console.error("[DEBUG] Page ID is missing. Save aborted."),O=!1,z(),e.abrupt("return");case 13:return console.log("[DEBUG] Locking all unlocked blocks before saving draft."),I.querySelectorAll(".grid-item").forEach((function(e){var t=e.querySelector(".lock-overlay");t&&"false"===t.dataset.locked&&J(e)})),Q(),c={page_id:r,layout:w,status:n},console.log('[DEBUG] Saving layout with status "'.concat(n,'" and payload:'),JSON.stringify(c,null,2)),console.log("[DEBUG] Payload being sent:",c),e.prev=20,e.next=23,fetch("/api/save-layout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});case 23:return a=e.sent,console.log("[DEBUG] Save response status: ".concat(a.status)),e.next=27,a.json();case 27:l=e.sent,console.log("[DEBUG] Server Response After Save:",JSON.stringify(l,null,2)),a.ok?(V(),A=!1,"live"===n&&(C=!0),console.log("[DEBUG] Layout saved successfully."),0===w.length?(console.log("[DEBUG] Layout is empty. Rendering 'NO DRAFT SAVED' message."),te([])):(console.log("[DEBUG] Layout has blocks. Hiding 'NO DRAFT SAVED' message."),(i=document.querySelector(".no-saved-draft-container"))&&i.remove()),C||U||"draft"!==S||null!==R||(W(),console.log("[DEBUG] Sortable.js re-initialized after saving."))):(console.error("[DEBUG] Save failed with status:",a.status),alert("Failed to save the layout. Please try again.")),e.next=36;break;case 32:e.prev=32,e.t0=e.catch(20),console.error("[DEBUG] Error saving layout:",e.t0),alert("An error occurred while saving the layout.");case 36:return e.prev=36,O=!1,z(),e.finish(36);case 40:case"end":return e.stop()}}),e,null,[[20,32,36,40]])})));return function(t){return e.apply(this,arguments)}}(),te=function(e){var t=I.querySelector(".no-saved-draft-container");if(t&&t.remove(),I.innerHTML="",R=null,0===e.length&&"draft"===S){var n=document.createElement("div");return n.classList.add("no-saved-draft-container"),n.innerHTML='\n                <h1 class="no-saved-draft">NO DRAFT SAVED</h1>\n            ',I.appendChild(n),void console.log("[DEBUG] Rendered 'NO DRAFT SAVED' message.")}e.forEach((function(e){var t=document.createElement("div");t.className="grid-item ".concat(e.type," default-border"),t.dataset.blockId=e.block_id,t.dataset.row=e.row,t.dataset.col=e.col,t.dataset.width=e.width,t.dataset.height=e.height;var n=e.type.startsWith("block-spacer");t.classList.toggle("spacer-block",n);var o="draft"===S&&!U&&!n&&!1===e.locked;t.innerHTML='\n                <div class="block-content" contenteditable="'.concat(o,'">').concat(e.content||"",'</div>\n                <div class="lock-overlay" data-locked="').concat(!1===e.locked?"false":"true",'">\n                    <img src="').concat(!1===e.locked?b:y,'" alt="').concat(!1===e.locked?"Unlocked":"Locked",'" class="lock-icon" />\n                </div>\n            '),!1===e.locked&&(t.classList.remove("default-border"),t.classList.add("unlocked-border"),R=t,console.log("[DEBUG] Block is unlocked on render:",e.block_id)),I.appendChild(t),t.querySelector(".lock-overlay").addEventListener("click",(function(e){e.stopPropagation(),Y(t)&&J(t)})),U&&(t.classList.add("delete-border"),console.log("[DEBUG] 'delete-border' class applied to block during rendering."))})),!R&&"draft"===S&&!U&&e.length>0?(W(),console.log("[DEBUG] Sortable.js initialized after rendering all blocks as locked.")):console.log("[DEBUG] Sortable.js not initialized because a block is unlocked, no blocks exist, or other conditions not met.")},ne=function(){if(e){if(e.querySelector(".no-saved-draft-container"))return void console.log("[DEBUG] 'NO DRAFT SAVED' message already exists. Not adding another.");var t=document.createElement("div");t.classList.add("no-saved-draft-container"),t.innerHTML='\n                <h1 class="no-saved-draft">NO DRAFT SAVED</h1>\n            ',e.appendChild(t),console.log("[DEBUG] Displayed 'NO DRAFT SAVED' message due to fetch error.")}else console.log("[DEBUG] gridPreviewContainer is null. Cannot display 'NO DRAFT SAVED' message.")},oe=function(){var e=o(t().mark((function e(){var n,o,r,c,a,l=arguments;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=l.length>0&&void 0!==l[0]&&l[0],I){e.next=4;break}return console.log("[DEBUG] gridContainer is null. No fetch performed."),e.abrupt("return");case 4:if(r=null===(n=document.querySelector(".side-panel .active"))||void 0===n?void 0:n.dataset.page){e.next=8;break}return console.error("[DEBUG] Page ID is missing. Fetch aborted."),e.abrupt("return");case 8:return console.log("[DEBUG] Fetching layout for page ID: ".concat(r," with status: ").concat(S)),e.prev=9,e.next=12,fetch("/api/content/".concat(r,"?status=").concat(S));case 12:if(c=e.sent,console.log("[DEBUG] Fetch response status: ".concat(c.status)),404!==c.status||"draft"!==S){e.next=18;break}return console.log("[DEBUG] No draft exists for this page."),ne(),e.abrupt("return");case 18:if(c.ok){e.next=20;break}throw new Error("Fetch failed with status: ".concat(c.status));case 20:return e.next=22,c.json();case 22:a=e.sent,console.log("[DEBUG] Fetched blocks:",JSON.stringify(a,null,2)),te(a),o&&"draft"===S&&!U&&null===R&&a.length>0&&(console.log("[DEBUG] Reinitializing Sortable.js after fetching layout..."),W()),"draft"===S&&(Q(),K(),A=!1,C=!1,z()),e.next=33;break;case 29:e.prev=29,e.t0=e.catch(9),console.error("[DEBUG] Error fetching layout:",e.t0),"draft"===S&&ne();case 33:case"end":return e.stop()}}),e,null,[[9,29]])})));return function(){return e.apply(this,arguments)}}(),re=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];I?(te(e),t&&"draft"===S&&!U&&!R&&e.length>0?W():E&&(E.destroy(),E=null,console.log("[DEBUG] Sortable.js instance destroyed in renderLayout."))):console.log("[DEBUG] gridContainer is null. Cannot render layout.")};c?c.innerHTML='<span class="add-block-icon">+</span> Add':console.error("[DEBUG] Add Block button not found.");var ce=function(){if("draft"===S){console.log("[DEBUG] Add Block button clicked.");var e=n.value,t={type:e,content:e.replace("-"," ").toUpperCase(),row:1,col:1,style:""};w.push(t);var o=document.createElement("div");o.className="grid-item ".concat(t.type," default-border"),o.dataset.blockId=t.block_id||null,o.innerHTML='\n            <div class="block-content">'.concat(t.content,'</div>\n            <div class="lock-overlay" data-locked="true">\n                <img src="').concat(y,'" alt="Locked" class="lock-icon" />\n            </div>\n        '),I.appendChild(o);var r=I.querySelector(".no-saved-draft-container");r&&(r.remove(),console.log("[DEBUG] 'NO DRAFT SAVED' message removed after adding a block.")),o.querySelector(".lock-overlay").addEventListener("click",(function(e){e.stopPropagation(),Y(o)&&J(o)}));var c=I.getBoundingClientRect(),a=o.getBoundingClientRect();I.scrollTo({top:I.scrollTop+(a.top-c.top)-c.height/2+a.height/2,behavior:"smooth"}),A=!0,C=!1,z(),K(),console.log("[DEBUG] Block added to the layout and DOM updated.")}};d.addEventListener("click",o(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F.lock();case 2:if(e.prev=2,confirm("Are you sure you want to clear all content?")){e.next=7;break}return console.log("[DEBUG] Clear Content action canceled by the user."),e.abrupt("return");case 7:le();case 8:return e.prev=8,F.unlock(),e.finish(8);case 11:case"end":return e.stop()}}),e,null,[[2,,8,11]])})))),c.addEventListener("click",o(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F.lock();case 2:if(e.prev=2,!P){e.next=6;break}return console.log("[DEBUG] Add Block action is already in progress. Ignoring additional click."),e.abrupt("return");case 6:if(N){e.next=9;break}return alert("Please select a block type first."),e.abrupt("return");case 9:P=!0,console.log("[DEBUG] Add Block button clicked.");try{ce()}catch(e){console.error("[DEBUG] Error in addBlock:",e)}case 12:return e.prev=12,P=!1,F.unlock(),e.finish(12);case 16:case"end":return e.stop()}}),e,null,[[2,,12,16]])})))),a.addEventListener("click",o(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F.lock();case 2:if(e.prev=2,"draft"===S){e.next=5;break}return e.abrupt("return");case 5:if(!O){e.next=8;break}return console.log("[DEBUG] Save operation already in progress. Please wait."),e.abrupt("return");case 8:return console.log("[DEBUG] Save Draft button clicked."),e.next=11,ee("draft");case 11:return e.prev=11,F.unlock(),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[2,,11,14]])})))),l.addEventListener("click",o(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F.lock();case 2:if(e.prev=2,"draft"===S){e.next=5;break}return e.abrupt("return");case 5:if(!A){e.next=8;break}return alert("Please save your changes before pushing live."),e.abrupt("return");case 8:if(!O){e.next=11;break}return console.log("[DEBUG] Save operation in progress. Please wait."),e.abrupt("return");case 11:if(confirm("Warning: Once this content is pushed live, it cannot be undone. Do you wish to proceed?")){e.next=15;break}return console.log("[DEBUG] Push Live action canceled by the user."),e.abrupt("return");case 15:return console.log("[DEBUG] Push Live button clicked."),e.next=18,ee("live");case 18:w=[],D=[JSON.parse(JSON.stringify(w))],x=[],re(w),console.log("[DEBUG] Rendered 'NO DRAFT SAVED' message after pushing live.");case 23:return e.prev=23,F.unlock(),e.finish(23);case 26:case"end":return e.stop()}}),e,null,[[2,,23,26]])})))),i.addEventListener("click",o(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F.lock();case 2:if(e.prev=2,!j){e.next=6;break}return console.log("[DEBUG] Undo action is already in progress. Ignoring additional click."),e.abrupt("return");case 6:if(!O){e.next=9;break}return console.log("[DEBUG] Save operation in progress. Preventing undo."),e.abrupt("return");case 9:console.log("[DEBUG] Undo button clicked."),j=!0;try{Z()}catch(e){console.error("[DEBUG] Error during undo:",e)}case 12:return e.prev=12,j=!1,F.unlock(),e.finish(12);case 16:case"end":return e.stop()}}),e,null,[[2,,12,16]])})))),s.addEventListener("click",o(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F.lock();case 2:if(e.prev=2,!M){e.next=6;break}return console.log("[DEBUG] Redo action is already in progress. Ignoring additional click."),e.abrupt("return");case 6:if(!O){e.next=9;break}return console.log("[DEBUG] Save operation in progress. Preventing redo."),e.abrupt("return");case 9:console.log("[DEBUG] Redo button clicked."),M=!0;try{$()}catch(e){console.error("[DEBUG] Error during redo:",e)}case 12:return e.prev=12,M=!1,F.unlock(),e.finish(12);case 16:case"end":return e.stop()}}),e,null,[[2,,12,16]])})))),u.addEventListener("click",o(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F.lock();case 2:if(e.prev=2,!q){e.next=6;break}return console.log("[DEBUG] Delete Mode toggle is already in progress. Ignoring additional click."),e.abrupt("return");case 6:if(!O){e.next=9;break}return console.log("[DEBUG] Save operation in progress. Preventing toggling delete mode."),e.abrupt("return");case 9:console.log("[DEBUG] Delete Mode button clicked."),q=!0;try{"draft"===S&&(U=!U,console.log("[DEBUG] Delete mode ".concat(U?"enabled":"disabled",".")),I.classList.toggle("delete-mode",U),Array.from(I.children).forEach((function(e){e.classList.toggle("delete-border",U),U||e.classList.contains("unlocked-border")||e.classList.add("default-border")})),U?u.classList.add("delete-mode-active"):u.classList.remove("delete-mode-active"),c.disabled=U,a.disabled=U,l.disabled=U,g.disabled=U,d.disabled=U,n.disabled=U,m&&(m.disabled=U||"live"===S),f.disabled=U,U?(I.addEventListener("click",X),E&&(E.destroy(),E=null,console.log("[DEBUG] Sortable.js instance destroyed for delete mode."))):(I.removeEventListener("click",X),c.disabled=!1,a.disabled=A||O||"live"===S,l.disabled=A||O||C||"live"===S,g.disabled=!1,d.disabled=!1,n.disabled=!1,m&&(m.disabled="live"===S),f.disabled=!1,T&&(A=!0,C=!1,T=!1,D=[JSON.parse(JSON.stringify(w))],x=[],console.log("[DEBUG] Layout history reset after exiting delete mode.")),z(),"draft"===S&&W()),Array.from(I.children).forEach((function(e){e.style.cursor=U?"pointer":"default"})),V())}catch(e){console.error("[DEBUG] Error toggling delete mode:",e)}case 12:return e.prev=12,q=!1,F.unlock(),e.finish(12);case 16:case"end":return e.stop()}}),e,null,[[2,,12,16]])}))));var ae=function(){var e=o(t().mark((function e(){var o,r,d,v,p,h;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F.lock();case 2:if(e.prev=2,o=function(e){[c,a,l,u,n,i,s,m,g].forEach((function(t){t&&(t.disabled=!e)}))},r=function(e){document.querySelectorAll(".lock-overlay").forEach((function(t){t.style.display=e?"block":"none"})),e?I.classList.remove("disable-hover"):I.classList.add("disable-hover")},"draft"!==S){e.next=42;break}if(S="live",f.textContent="View Draft",v=null===(d=document.querySelector(".side-panel .active"))||void 0===d?void 0:d.dataset.page){e.next=12;break}return console.error("[DEBUG] Page ID is missing. Cannot fetch live content."),e.abrupt("return");case 12:return console.log("[DEBUG] Switching to live view for page ID: ".concat(v)),e.prev=13,e.next=16,fetch("/api/content/".concat(v,"?status=live"));case 16:if((p=e.sent).ok){e.next=19;break}throw new Error("Failed to fetch live content. Status: ".concat(p.status));case 19:return e.next=21,p.json();case 21:if(h=e.sent,console.log("[DEBUG] Fetched live blocks:",h),0!==h.length){e.next=30;break}return console.log("[DEBUG] No live content available to display."),I.innerHTML='\n                            <div class="no-saved-draft-container">\n                                <h1 class="no-saved-draft">NO CONTENT AVAILABLE</h1>\n                            </div>\n                        ',o(!1),r(!1),z(),e.abrupt("return");case 30:re(h,!1),console.log("[DEBUG] Live content rendered successfully."),o(!1),r(!1),e.next=40;break;case 36:e.prev=36,e.t0=e.catch(13),console.error("[DEBUG] Error fetching live content:",e.t0),alert("Failed to switch to live view.");case 40:e.next=57;break;case 42:if(S="draft",f.textContent="View Live",console.log("[DEBUG] Switching back to draft view."),0!==w.length){e.next=52;break}return console.log("[DEBUG] No blocks in localLayout. Rendering 'NO DRAFT SAVED' message."),I.innerHTML='\n                        <div class="no-saved-draft-container">\n                            <h1 class="no-saved-draft">NO DRAFT SAVED</h1>\n                        </div>',o(!0),r(!0),z(),e.abrupt("return");case 52:re(w,!0),K(),console.log("[DEBUG] Restored draft layout from memory."),o(!0),r(!0);case 57:z();case 58:return e.prev=58,F.unlock(),e.finish(58);case 61:case"end":return e.stop()}}),e,null,[[2,,58,61],[13,36]])})));return function(){return e.apply(this,arguments)}}();f.removeEventListener("click",(function(){})),f.addEventListener("click",ae);var le=function(){"draft"===S&&(console.log("[DEBUG] Clear Content button clicked."),0!==w.length?(K(),re(w=[]),A=!0,C=!1,z(),console.log("[DEBUG] All content cleared from the preview.")):alert("No content to clear."))};if(g.addEventListener("click",o(t().mark((function e(){var n,o,r,c,a,l;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F.lock();case 2:if(e.prev=2,"draft"===S){e.next=6;break}return alert("Switch to draft mode before copying live content."),e.abrupt("return");case 6:if(o=null===(n=document.querySelector(".side-panel .active"))||void 0===n?void 0:n.dataset.page){e.next=10;break}return console.error("[DEBUG] Page ID is missing. Cannot copy live content."),e.abrupt("return");case 10:return console.log("[DEBUG] Copying live content for page ID: ".concat(o)),e.prev=11,e.next=14,fetch("/api/content/".concat(o,"?status=live"));case 14:if((r=e.sent).ok){e.next=17;break}throw new Error("Failed to fetch live content. Status: ".concat(r.status));case 17:return e.next=19,r.json();case 19:if(c=e.sent,console.log("[DEBUG] Fetched live blocks:",c),0!==c.length){e.next=24;break}return alert("No live content to copy."),e.abrupt("return");case 24:if(a=w.length>0,l=A,!a&&!l){e.next=31;break}if(confirm("Warning: This action will overwrite any unsaved changes in your draft. Do you wish to proceed?")){e.next=31;break}return console.log("[DEBUG] Copy Live action canceled by the user."),e.abrupt("return");case 31:re(w=c),K(),A=!0,C=!1,z(),console.log("[DEBUG] Live content copied to draft and rendered locally. Changes are unsaved."),alert("Live content has been copied to draft. Remember to save changes."),e.next=45;break;case 41:e.prev=41,e.t0=e.catch(11),console.error("[DEBUG] Error copying live content:",e.t0),alert("An error occurred while copying live content.");case 45:return e.prev=45,F.unlock(),e.finish(45);case 48:case"end":return e.stop()}}),e,null,[[2,,45,48],[11,41]])})))),I&&I.addEventListener("input",(function(e){e.target.classList.contains("block-content")&&(A=!0,C=!1,z(),Q(),K())})),window.addEventListener("beforeunload",(function(e){A&&(e.preventDefault(),e.returnValue="")})),m&&k){var ie=m.textContent.trim()||"Select an option";console.log("[DEBUG] customDropdownToggle textContent:",ie),m.innerHTML="".concat(ie,' <span class="block-dropdown-arrow">&#x25BC;</span>'),m.addEventListener("click",(function(e){e.stopPropagation();var t="block"===k.style.display;k.style.display=t?"none":"block",m.setAttribute("aria-expanded",!t),t||(k.querySelectorAll(".submenu-open").forEach((function(e){e.classList.remove("submenu-open")})),k.querySelectorAll(".submenu-hover").forEach((function(e){e.classList.remove("submenu-hover")})))})),k.querySelectorAll("li").forEach((function(e){e.addEventListener("click",(function(t){if(t.stopPropagation(),e.classList.contains("dropdown-submenu")){var o=e.classList.toggle("submenu-open");return o?e.classList.add("submenu-hover"):e.classList.remove("submenu-hover"),void(o&&(k.style.display="block",m.setAttribute("aria-expanded","true")))}var r=e.getAttribute("data-value"),c=e.textContent.trim();N=r,m.innerHTML="".concat(c,' <span class="block-dropdown-arrow">&#x25BC;</span>'),n.value=r,k.style.display="none",m.setAttribute("aria-expanded","false")}))})),document.addEventListener("click",(function(e){k.contains(e.target)||m.contains(e.target)||(k.style.display="none",m.setAttribute("aria-expanded","false"),k.querySelectorAll(".submenu-open").forEach((function(e){e.classList.remove("submenu-open")})),k.querySelectorAll(".submenu-hover").forEach((function(e){e.classList.remove("submenu-hover")})))}))}else console.error("[DEBUG] Custom dropdown elements are missing.");"draft"===S&&I&&oe(!0),window.addEventListener("blockLockChanged",(function(e){var t=e.detail,n=t.blockId,o=t.isLocked;console.log("[DEBUG] 'blockLockChanged' event received for block ID: ".concat(n,", Locked: ").concat(o));var r,c,a=document.querySelector('.grid-item[data-block-id="'.concat(n,'"]'));a&&(o?a.classList.contains("grid-overlay-active")&&(a.classList.remove("grid-overlay-active"),gridOverlayActive=!1,console.log("[DEBUG] Grid overlay removed from locked block.")):gridOverlayActive=!1),r=document.querySelectorAll(".toolbar-row.second-row button"),c=null!==R,r.forEach((function(e){e.disabled=!c})),console.log("[DEBUG] Second row buttons ".concat(c?"enabled":"disabled","."))}))}else console.error("[DEBUG] One or more critical DOM elements are missing. Script aborted.")}))})(),(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){"use strict";t=function(){return o};var n,o={},r=Object.prototype,c=r.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},l="function"==typeof Symbol?Symbol:{},i=l.iterator||"@@iterator",s=l.asyncIterator||"@@asyncIterator",d=l.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(n){u=function(e,t,n){return e[t]=n}}function f(e,t,n,o){var r=t&&t.prototype instanceof m?t:m,c=Object.create(r.prototype),l=new T(o||[]);return a(c,"_invoke",{value:U(e,n,l)}),c}function g(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}o.wrap=f;var v="suspendedStart",p="suspendedYield",h="executing",y="completed",b={};function m(){}function k(){}function E(){}var B={};u(B,i,(function(){return this}));var w=Object.getPrototypeOf,D=w&&w(w(O([])));D&&D!==r&&c.call(D,i)&&(B=D);var x=E.prototype=m.prototype=Object.create(B);function L(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function G(t,n){function o(r,a,l,i){var s=g(t[r],t,a);if("throw"!==s.type){var d=s.arg,u=d.value;return u&&"object"==e(u)&&c.call(u,"__await")?n.resolve(u.__await).then((function(e){o("next",e,l,i)}),(function(e){o("throw",e,l,i)})):n.resolve(u).then((function(e){d.value=e,l(d)}),(function(e){return o("throw",e,l,i)}))}i(s.arg)}var r;a(this,"_invoke",{value:function(e,t){function c(){return new n((function(n,r){o(e,t,n,r)}))}return r=r?r.then(c,c):c()}})}function U(e,t,o){var r=v;return function(c,a){if(r===h)throw Error("Generator is already running");if(r===y){if("throw"===c)throw a;return{value:n,done:!0}}for(o.method=c,o.arg=a;;){var l=o.delegate;if(l){var i=S(l,o);if(i){if(i===b)continue;return i}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(r===v)throw r=y,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);r=h;var s=g(e,t,o);if("normal"===s.type){if(r=o.done?y:p,s.arg===b)continue;return{value:s.arg,done:o.done}}"throw"===s.type&&(r=y,o.method="throw",o.arg=s.arg)}}}function S(e,t){var o=t.method,r=e.iterator[o];if(r===n)return t.delegate=null,"throw"===o&&e.iterator.return&&(t.method="return",t.arg=n,S(e,t),"throw"===t.method)||"return"!==o&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+o+"' method")),b;var c=g(r,e.iterator,t.arg);if("throw"===c.type)return t.method="throw",t.arg=c.arg,t.delegate=null,b;var a=c.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,b):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,b)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function O(t){if(t||""===t){var o=t[i];if(o)return o.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,a=function e(){for(;++r<t.length;)if(c.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=n,e.done=!0,e};return a.next=a}}throw new TypeError(e(t)+" is not iterable")}return k.prototype=E,a(x,"constructor",{value:E,configurable:!0}),a(E,"constructor",{value:k,configurable:!0}),k.displayName=u(E,d,"GeneratorFunction"),o.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===k||"GeneratorFunction"===(t.displayName||t.name))},o.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,E):(e.__proto__=E,u(e,d,"GeneratorFunction")),e.prototype=Object.create(x),e},o.awrap=function(e){return{__await:e}},L(G.prototype),u(G.prototype,s,(function(){return this})),o.AsyncIterator=G,o.async=function(e,t,n,r,c){void 0===c&&(c=Promise);var a=new G(f(e,t,n,r),c);return o.isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},L(x),u(x,d,"Generator"),u(x,i,(function(){return this})),u(x,"toString",(function(){return"[object Generator]"})),o.keys=function(e){var t=Object(e),n=[];for(var o in t)n.push(o);return n.reverse(),function e(){for(;n.length;){var o=n.pop();if(o in t)return e.value=o,e.done=!1,e}return e.done=!0,e}},o.values=O,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(A),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function o(o,r){return l.type="throw",l.arg=e,t.next=o,r&&(t.method="next",t.arg=n),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],l=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var i=c.call(a,"catchLoc"),s=c.call(a,"finallyLoc");if(i&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(i){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&c.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=e,a.arg=t,r?(this.method="next",this.next=r.finallyLoc,b):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var o=n.completion;if("throw"===o.type){var r=o.arg;A(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(e,t,o){return this.delegate={iterator:O(e),resultName:t,nextLoc:o},"next"===this.method&&(this.arg=n),b}},o}function n(e,t,n,o,r,c,a){try{var l=e[c](a),i=l.value}catch(e){return void n(e)}l.done?t(i):Promise.resolve(i).then(o,r)}function o(e){return function(){var t=this,o=arguments;return new Promise((function(r,c){var a=e.apply(t,o);function l(e){n(a,r,c,l,i,"next",e)}function i(e){n(a,r,c,l,i,"throw",e)}l(void 0)}))}}document.addEventListener("DOMContentLoaded",(function(){if(console.log("[DEBUG] secondToolbar.js loaded and DOMContentLoaded triggered."),document.querySelector(".toolbar-row.second-row")){console.log("[DEBUG] Second toolbar row found.");var e=document.getElementById("toggleGridOverlayButton"),n=document.getElementById("addImageButton"),r=document.getElementById("imageLinkButton"),c=document.getElementById("addTextButton"),a=document.getElementById("textLinkButton"),l=document.getElementById("resizeImageButton"),i=document.getElementById("cropImageButton"),s=document.getElementById("addGalleryButton"),d=document.getElementById("addSponsoredAdButton"),u=document.getElementById("colorPickerButton"),f=document.getElementById("layerControlButton"),g=document.getElementById("duplicateContentButton"),v=document.getElementById("lockElementButton"),p=document.getElementById("embedHTMLButton"),h=document.getElementById("animationEffectsButton"),y=document.getElementById("alignmentToolsButton"),b=document.getElementById("fontStylingButton"),m=[e,n,r,c,a,l,i,s,d,u,f,g,v,p,h,y,b];m.forEach((function(e){e&&(e.disabled=!0)})),console.log("[DEBUG] Second toolbar buttons disabled on page load.");var k={liveViewButton:document.getElementById("viewToggleButton"),copyLiveButton:document.getElementById("copyLiveButton"),clearContentButton:document.getElementById("clearContentButton"),blockTypeDropdown:document.getElementById("blockTypeControl"),addBlockButton:document.getElementById("addBlockButton"),deleteModeButton:document.getElementById("deleteModeButton"),pushLiveButton:document.getElementById("pushLiveButton")},E=m.filter((function(e){return!e}));if(E.length>0)console.error("[DEBUG] Missing buttons in second toolbar row: ".concat(E.map((function(e){return e.id})).join(", "),". secondToolbar.js aborted."));else{console.log("[DEBUG] All second row toolbar buttons are present.");var B=window.sharedMutex;if(B){console.log("[DEBUG] Shared mutex accessed successfully.");var w=0,D=["grid-overlay-small","grid-overlay-medium","grid-overlay-large"];e.addEventListener("click",o(t().mark((function e(){var n,o;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.lock();case 2:if(e.prev=2,console.log("[DEBUG] Toggle Grid Overlay button clicked."),n=document.querySelector(".grid-item.unlocked-border")){e.next=9;break}return console.warn("[DEBUG] No unlocked block found. Grid Overlay toggle aborted."),alert("No unlocked block found to toggle the grid overlay."),e.abrupt("return");case 9:n.classList.contains("grid-overlay-active")?((o=n.classList).remove.apply(o,D),(w=(w+1)%(D.length+1))===D.length?(n.classList.remove("grid-overlay-active"),console.log("[DEBUG] Grid overlay turned off.")):(n.classList.add(D[w]),console.log("[DEBUG] Grid overlay size updated to: ".concat(D[w])))):(w=0,n.classList.add("grid-overlay-active",D[w]),console.log("[DEBUG] Grid overlay added to the unlocked block with size: ".concat(D[w]))),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),console.error("[DEBUG] Error in Toggle Grid Overlay button:",e.t0);case 16:return e.prev=16,B.unlock(),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[2,13,16,19]])})))),n.addEventListener("click",o(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.lock();case 2:try{console.log("[DEBUG] Add Image button clicked.")}catch(e){console.error("[DEBUG] Error in Add Image button:",e)}finally{B.unlock()}case 3:case"end":return e.stop()}}),e)})))),r.addEventListener("click",o(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.lock();case 2:try{console.log("[DEBUG] Image Link button clicked.")}catch(e){console.error("[DEBUG] Error in Image Link button:",e)}finally{B.unlock()}case 3:case"end":return e.stop()}}),e)})))),c.addEventListener("click",o(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.lock();case 2:try{console.log("[DEBUG] Add Text button clicked.")}catch(e){console.error("[DEBUG] Error in Add Text button:",e)}finally{B.unlock()}case 3:case"end":return e.stop()}}),e)})))),a.addEventListener("click",o(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.lock();case 2:try{console.log("[DEBUG] Text Link button clicked.")}catch(e){console.error("[DEBUG] Error in Text Link button:",e)}finally{B.unlock()}case 3:case"end":return e.stop()}}),e)})))),l.addEventListener("click",o(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.lock();case 2:try{console.log("[DEBUG] Resize Image button clicked.")}catch(e){console.error("[DEBUG] Error in Resize Image button:",e)}finally{B.unlock()}case 3:case"end":return e.stop()}}),e)})))),i.addEventListener("click",o(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.lock();case 2:try{console.log("[DEBUG] Crop Image button clicked.")}catch(e){console.error("[DEBUG] Error in Crop Image button:",e)}finally{B.unlock()}case 3:case"end":return e.stop()}}),e)})))),s.addEventListener("click",o(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.lock();case 2:try{console.log("[DEBUG] Add Gallery button clicked.")}catch(e){console.error("[DEBUG] Error in Add Gallery button:",e)}finally{B.unlock()}case 3:case"end":return e.stop()}}),e)})))),d.addEventListener("click",o(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.lock();case 2:try{console.log("[DEBUG] Add Sponsored Ad button clicked.")}catch(e){console.error("[DEBUG] Error in Add Sponsored Ad button:",e)}finally{B.unlock()}case 3:case"end":return e.stop()}}),e)})))),u.addEventListener("click",o(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.lock();case 2:try{console.log("[DEBUG] Color Picker button clicked.")}catch(e){console.error("[DEBUG] Error in Color Picker button:",e)}finally{B.unlock()}case 3:case"end":return e.stop()}}),e)})))),f.addEventListener("click",o(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.lock();case 2:try{console.log("[DEBUG] Layer Control button clicked.")}catch(e){console.error("[DEBUG] Error in Layer Control button:",e)}finally{B.unlock()}case 3:case"end":return e.stop()}}),e)})))),g.addEventListener("click",o(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.lock();case 2:try{console.log("[DEBUG] Duplicate Content button clicked.")}catch(e){console.error("[DEBUG] Error in Duplicate Content button:",e)}finally{B.unlock()}case 3:case"end":return e.stop()}}),e)})))),v.addEventListener("click",o(t().mark((function e(){var n;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.lock();case 2:try{console.log("[DEBUG] Lock Element button clicked."),(n=document.querySelector(".grid-item.unlocked-border"))&&toggleBlockLock(n)}catch(e){console.error("[DEBUG] Error in Lock Element button:",e)}finally{B.unlock()}case 3:case"end":return e.stop()}}),e)})))),p.addEventListener("click",o(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.lock();case 2:try{console.log("[DEBUG] Embed HTML button clicked.")}catch(e){console.error("[DEBUG] Error in Embed HTML button:",e)}finally{B.unlock()}case 3:case"end":return e.stop()}}),e)})))),h.addEventListener("click",o(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.lock();case 2:try{console.log("[DEBUG] Animation Effects button clicked.")}catch(e){console.error("[DEBUG] Error in Animation Effects button:",e)}finally{B.unlock()}case 3:case"end":return e.stop()}}),e)})))),y.addEventListener("click",o(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.lock();case 2:try{console.log("[DEBUG] Alignment Tools button clicked.")}catch(e){console.error("[DEBUG] Error in Alignment Tools button:",e)}finally{B.unlock()}case 3:case"end":return e.stop()}}),e)})))),b.addEventListener("click",o(t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B.lock();case 2:try{console.log("[DEBUG] Font Styling button clicked.")}catch(e){console.error("[DEBUG] Error in Font Styling button:",e)}finally{B.unlock()}case 3:case"end":return e.stop()}}),e)})))),window.addEventListener("blockLockChanged",(function(e){var t,n=e.detail,o=n.blockId,r=n.isLocked;console.log("[DEBUG] 'blockLockChanged' event triggered for blockId: ".concat(o,", isLocked: ").concat(r)),t=null!==document.querySelector(".grid-item.unlocked-border"),m.forEach((function(e){e.disabled=!t})),Object.values(k).forEach((function(e){e.disabled=t})),console.log("[DEBUG] Buttons updated. Second row: ".concat(t?"enabled":"disabled",", Top row: ").concat(t?"disabled":"enabled","."))})),console.log("[DEBUG] Button state management setup complete.")}else console.error("[DEBUG] Shared mutex not found on window. Ensure contentWorkshop.js exposes the mutex.")}}else console.error("[DEBUG] Second toolbar row not found. secondToolbar.js aborted.")}))})();