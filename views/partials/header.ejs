<!-- views/partials/header.ejs -->

<% if (isProduction) { %>
  <!-- Production: Load Webpack Bundles -->
  <link rel="stylesheet" href="/styles.css">
  <script src="/bundle.js"></script>
<% } else { %>
  <!-- Development: Load Unbundled Files -->
  <link rel="stylesheet" href="/styles/styles.css">
  <script src="/scripts/main.js"></script>
<% } %>

<!-- Include Staff Header only for staff roles -->
<% if (['superadmin', 'staff1', 'staff2', 'manager1', 'manager2'].includes(user?.role)) { %>
  <div class="staff-header-wrapper">
    <%- include('../partials/staff-header', { user: user }) %>
  </div>
<% } %>

<!-- Main header content -->
<header>
  <a title="Logo" href="/" class="logo">Novelty Drop Co.</a>
  <div class="profile" id="profile" data-csrf="<%= csrfToken %>">
    <% if (!user) { %>
      <div class="sign-in-button" title="Sign in">Hello, Sign in</div>
    <% } else { %>
      <p class="welcome-message">Welcome, <%= user.first_name %>!</p>
      <img src="/images/profile-icon.png" class="profile-pic" alt="Profile" id="profile-picture" />
    <% } %>
    <div id="dropdown" class="dropdown-content">
      <% if (!user) { %>
        <div id="login-form" class="form-content">
          <h2>Login</h2>
          <form action="/login" method="POST" id="loginForm">
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <input type="text" placeholder="Email" id="email" name="email" required>
            <input type="password" placeholder="Password" id="password" name="password" required>
            <button type="submit" id="login-button">Login</button>
          </form>
          <p><a href="#" class="create-account" id="show-register">Create account</a></p>
        </div>

        <div id="register-form" class="form-content hidden">
          <h2>Create Account</h2>
          <form action="/customer-register" method="POST" id="registerForm">
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <input type="text" placeholder="First Name" id="first_name" name="first_name" required>
            <input type="text" placeholder="Last Name" id="last_name" name="last_name" required>
            <input type="email" placeholder="Email" id="register_email" name="email" required>
            <input type="password" placeholder="Password" id="register_password" name="password" required>
            <input type="password" placeholder="Confirm Password" id="confirm_password" name="confirm_password" required>
            <button type="submit" id="register-button">Register</button>
          </form>
          <p><div class="center-link"><a href="#" class="back-to-login" id="show-login">Back to login</a></div></p>
        </div>
      <% } else { %>
        <div id="user-menu" class="form-content">
          <form action="/logout" method="POST">
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <button type="submit">Logout</button>
          </form>
        </div>
      <% } %>
    </div>
  </div>
</header>

<% if (typeof flashMessage !== 'undefined') { %>
  <div class="flash-message <%= flashType %>">
    <%= flashMessage %>
  </div>
<% } %>

<div class="loading-spinner" id="loadingSpinner">
  <div class="spinner"></div>
</div>
